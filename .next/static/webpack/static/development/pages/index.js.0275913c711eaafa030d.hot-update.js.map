{"version":3,"file":"static/webpack/static/development/pages/index.js.0275913c711eaafa030d.hot-update.js","sources":["webpack:///./context.js"],"sourcesContent":["/* eslint-disable no-unused-vars */\nimport React, { Component } from 'react';\nimport axios from 'axios'\n\nconst RoomContext = React.createContext();\n// \n\nclass RoomProvider extends Component {\n    state={\n        rooms: [],\n        sortedRooms: [],\n        featuredRooms: [],\n        loading: true,\n        roomtype:'all',\n        capacity:1,\n        price:0,\n        minPrice: 0,\n        maxPrice: 0,\n        minSize: 0,\n        maxSize: 0,\n        breakfast: false,\n        PUBLICTOKEN: 'f3341f2f85860e06446a5e86bfd392',\n        authenticated: null,\n        chatUserId: 'guido',\n        activeWindow: '',\n        currentUser: {}\n    }\n    componentDidMount(){\n        const self = this;\n        axios({\n            url: 'https://graphql.datocms.com/',\n            method: 'post',\n            data: {\n              query: `{\n                allRooms {\n                    id\n                    name\n                    slug\n                    price\n                    roomtype\n                    size\n                    capacity\n                    breakfast\n                    pets\n                    featured\n                    description\n                    extras\n                    images {\n                      url\n                    }\n                  }\n                }`\n            },\n            headers: { 'Content-Type': 'application/json', 'Accept': 'application/json', 'Authorization': `Bearer ${this.state.PUBLICTOKEN}`,}\n          })\n        .then(function (response) {\n          // handle success\n          let rooms = self.formatData(response.data.data.allRooms);\n          let featuredRooms = rooms.filter(room => room.featured === true);\n            let maxPrice = Math.max(...rooms.map(item => item.price));\n            let maxSize = Math.max(...rooms.map(item => item.size));\n            self.setState({\n                rooms,\n                featuredRooms,\n                sortedRooms: rooms,\n                loading: false,\n                price: maxPrice,\n                maxPrice,\n                maxSize\n            })\n          return rooms\n        }).catch(error => {\n            console.log(error)\n        })\n    }\n    setCurrentUser = (currentUser) => {\n        this.setState({currentUser})\n    }\n\n    addChatRoom = (room) => {\n        this.setState(prevState => ({\n            currentUser:  {\n                \n            }\n        }))\n    }\n\n    formatData = (items) => {\n        let tempItems = items.map(item => {\n            let id = item.id;\n            let images = item.images.map(image => image.url);\n            let room = {...item,images,id};\n            return room;\n        });\n        return tempItems;\n    }\n    getRoom = (slug) => {\n        let tempRooms = [...this.state.rooms];\n        const room = tempRooms.find(room => room.slug === slug);\n        return room;\n\n    }\n\n    changeWindow = (window) => {\n        this.setState({\n            activeWindow: window\n        })\n    }\n\n    logOut = () => {\n        localStorage.removeItem('userData');\n        this.setState({authenticated: false}) \n    }\n\n    updateCredentials = (refresh, userId, email, token) => {\n        if (refresh === true) {\n            const userData = JSON.parse(localStorage.getItem('userData'));\n            if (userData && userData !== null) {\n                axios({\n                    url: 'https://express-login.now.sh/api/users/refresh',\n                    method: 'POST',\n                    data: JSON.stringify({\n                        email: userData.email\n                    }),\n                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${userData.token}`}\n                })\n                .then(res => {\n                    localStorage.setItem('userData', JSON.stringify({userId: res.data.userId, email: res.data.email, token: res.data.token}));\n                    this.setState({authenticated: true})\n                })\n                .catch(err => {\n                    localStorage.removeItem('userData');\n                    this.setState({authenticated: false})    \n                })\n            } else {\n                this.setState({authenticated: false})\n            }\n        } else {\n            localStorage.setItem('userData', JSON.stringify({userId: userId, email: email, token: token}));\n            this.setState({\n                authenticated: true\n            })\n        }\n    }\n    \n\n    handleChange = event => {\n        const target = event.target;\n        const value = target.type === 'checkbox' ? target.checked :\n        target.value\n        const name = event.target.name;\n        this.setState({\n            [name]: value\n        },this.filterRooms)\n        //callback function ^\n    }\n    filterRooms = () => {\n        let {\n            rooms,roomtype,capacity,price,minSize,maxSize,breakfast,pets\n        } = this.state\n        //all the rooms\n        let tempRooms = [...rooms];\n        //transform value\n        capacity = parseInt(capacity);\n        price = parseInt(price);\n        //filter by type\n        if (roomtype !== 'all') {\n            tempRooms = tempRooms.filter(room => room.roomtype === roomtype)\n        }\n        //filter by capacity\n        if (capacity !== 1) {\n            tempRooms = tempRooms.filter(room => room.capacity >= capacity)\n        }\n        //filter by price\n        tempRooms= tempRooms.filter(room => room.price <= price )\n        //filter extras\n        if ( breakfast ) {\n            tempRooms = tempRooms.filter(room => room.breakfast === true)\n        }\n        if ( pets ) {\n            tempRooms = tempRooms.filter(room => room.pets === true)\n        }\n        this.setState({\n            sortedRooms: tempRooms\n        })\n    }\n    render() {\n        return (\n            <RoomContext.Provider \n                value={{\n                    ...this.state,\n                    getRoom: this.getRoom,\n                    handleChange: this.handleChange,\n                    updateCredentials: this.updateCredentials,\n                    logOut: this.logOut,\n                    changeWindow: this.changeWindow,\n                    setCurrentUser: this.setCurrentUser\n                }}\n            >\n                {this.props.children}\n            </RoomContext.Provider>\n        )\n    }\n}\n\nconst RoomConsumer = RoomContext.Consumer;\n\nexport function withRoomConsumer(Component) {\n    return function ConsumerWrapper(props) {\n        return <RoomConsumer>\n            {value => <Component {...props} context={value}/>}\n        </RoomConsumer>\n    }\n}\n\nexport{ RoomProvider, RoomConsumer, RoomContext };\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAEA;AACA;AAEA;;;;;;;;;;;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjBA;AACA;AAkEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAKA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AAAA;AAAA;AAAA;AANA;AASA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAGA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AADA;AAGA;AACA;;;;;;AA/JA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAqBA;AAAA;AAAA;AAAA;AAAA;AAxBA;AA2BA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AACA;AACA;AACA;AACA;;;AAgHA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAPA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAcA;;;;AAnMA;AACA;AAqMA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;;;;;A","sourceRoot":""}